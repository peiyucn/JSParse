/* created at Monday, August 6th, 2018, 6:12:22 PM by Pei Yu */!function(n,e){n.JSParse=e()}(this,function(){function n(){}function e(n,e){this.selfObj=n,this.rootExpression=e,this.pChildNodes=[]}function r(n,r){var t=new e(n,r);return t.selfObj=n,t.rootExpression=r,t}function t(n){return void 0===n||null==n||n.length<=0}function o(n){var e,r;for(e=0;e<d.operators.length;e+=1)if((r=d.operators[e]).symbol==n)return r;return null}function u(n){var e,r;for(e=0;e<d.operators.length;e+=1)if((r=d.operators[e]).name==n)return r;return null}function s(n,e){var r,t;for(r=0;r<d.operators.length;r+=1)if((t=d.operators[r]).symbol.substr(e,1)==n&&"N"!=t.optype)return!0;return!1}function l(n,e){var r,t;for(r=0;r<d.operators.length;r+=1)if((t=d.operators[r]).symbol.substr(e,1)==n&&"N"==t.optype)return!0;return!1}function i(n){var e,r;for(e=0;e<d.operators.length;e+=1)if((r=d.operators[e]).name==n&&"N"==r.optype)return r;return null}function f(n){return 1==n?0:1}function a(n,e,r){var t,o=[];for(t=0;t<r;t+=1)o.push(n[e]),e++;return o}function p(n,e){var r=e.substr(0,1);if(r==d.quote||r==d.singleQuote)return e.replace(/^"*|"*$/g,"").replace(/^'*|'*$/g,"");var o=parseFloat(e);if(!isNaN(o))return o;if("true"==e)return!0;if("false"==e)return!1;var u,s=e.split("."),l=n;for(u=0;u<s.length;u+=1)if(l=l[s[u]],t(l))return null;return l}function c(n){var e;for(e=0;e<n.length;e+=1)if(":"==n[e])return e;return-1}function y(n){for(var e,r=-1,t=0,o=0,u=0;u<n.length;){if((e=n.substr(u,1))==d.quote&&(t=f(t)),e==d.singleQuote&&(o=f(o)),e==d.leftBracket&&0==t&&0==o)return r=u;u++}return r}function m(n,e){var r,t=e,o=0,u=0,s=0,l=!0;s+=1;do{if(++t>=n.length)break;if((r=n.substr(t,1))==d.quote&&(o=f(o)),r==d.singleQuote&&(u=f(u)),r==d.leftBracket&&0==o&&0==u&&s++,r==d.rightBracket&&0==o&&0==u&&s--,0==s)l=!1;else{if(!(s>0))break;l=!0}}while(l);if(0!=s)throw new Error("JSParse Exception: Wrong bracket numbers!");return t}function b(n){for(var e,r,t=[],o=0,u=0,s=0,l=0,i=0;o<n.length;)(e=n.substr(o,1))==d.quote&&(l=f(l)),e==d.singleQuote&&(i=f(i)),e==d.leftBracket&&0==l&&0==i&&s++,e==d.rightBracket&&0==l&&0==i&&s--,e==d.comma&&0==l&&0==i&&0==s&&(r=(r=n.substr(u,o-u)).replace(/^\s+|\s+$/g,""),t.push(r),u=o+1),o==n.length-1&&(r=(r=n.substr(u,n.length-u)).replace(/^\s+|\s+$/g,""),t.push(r)),o++;return t}function g(n,e){return-1==e||n[e]==d.leftBracket||s(n[e],0)?u("NG"):n[e]!=d.space?u("MINUS"):void g(n,e-1)}function h(n,e,r){if(!(r>=n.length)){var t,o,u,i,a=0,p=n.substr(r,1);if(p==d.quote){if(a=f(a),t=n.indexOf(d.quote,r),o=-1,(o=n.indexOf(d.quote,t+1))<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");a=f(a),u=n.substring(t,o+1),e.push(u),r=o+1}else if(p==d.singleQuote){if(a=f(a),t=n.indexOf(d.singleQuote,r),o=-1,(o=n.indexOf(d.singleQuote,t+1))<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");a=f(a),u=n.substring(t,o+1),e.push(u),r=o+1}else if(p==d.leftBracket){var c=n.indexOf(d.leftBracket,r),y=m(n,c);r=y;var b=n.substring(c+1,y);e.push(b),r++}else if(s(p,0)){var g=r,k=!0,N=1,v=null;if(p==d.questionMark||p==d.colon)v=n.substring(g,r+1),e.push(v),r++;else{for(;k&&!(++r>=n.length);)s(i=n.substr(r,1),N)?(k=!0,N++):k=!1;v=n.substring(g,r),e.push(v)}}else if(p==d.space)r++;else{for(var E=r,w=!0,x=0;r<n.length;){if(i=n.substr(r,1),l(i,x))w=!0,x++;else if(s(i,0)){w=!1;break}if(i==d.leftBracket){w=!0;break}r++}var O=null;if(w&&i==d.leftBracket){var S=m(n,r);O=n.substring(E,S+1),r=S+1}else O=n.substring(E,r);O=O.replace(/^\s+|\s+$/g,""),e.push(O)}h(n,e,r)}}function k(n){var e=[];return h(n,e,0),null==e||0==e.length?null:e}function N(n,e,t){var u,s,l,f,p,m,h,v,d,E=[],w=null,x=0,O=0,S=0,j=[];if(1==n.length){if(1==(E=k(n[0])).length){var F=y(n[0]);if(!(F>0)){var q=r(n[0]);return null==e||null==e.selfObj?(e=q).rootExpression=t:e.addNode(q),e}var B=i(n[0].substr(0,F));if(null==B)throw new Error("JSParse Exception: Wrong function name!");E=b(n[0].substr(F+1,n[0].length-(F+2))),w=B}n=E}for(u=0;u<n.length;u+=1)if(null!=(v=o(n[u]))){if("-"==v.symbol&&(v=g(n,u-1)),"?"==v.symbol){if(-1==(S=c(n)))throw new Error("JSParse Exception: Wrong expression!");w=o("?:"),O=u;break}null==w?(w=v,x=u):v.rank<=w.rank&&(w=v,x=u)}if(null==w)throw new Error("JSParse Exception: Wrong expressions!");var D=r(w);if(null==e||null==e.selfObj?(e=D).rootExpression=t:e.addNode(D),1==D.selfObj.optype)f=a(n,x+1,n.length-(x+1)),j.push(f);else if(2==D.selfObj.optype)p=a(n,0,x),m=a(n,x+1,n.length-(x+1)),j.push(p),j.push(m);else if(3==D.selfObj.optype)p=a(n,0,O),h=a(n,O+1,S-(O+1)),m=a(n,S+1,n.length-(S+1)),j.push(p),j.push(h),j.push(m);else if("N"==D.selfObj.optype)for(s=0;s<n.length;s+=1)d=[n[s]],j.push(d);for(l=0;l<j.length;l+=1)N(j[l],D,t);return e}e.prototype.addNode=function(n){return null==this?r(n):n==this.selfObj?this:void this.pChildNodes.push(n)},e.prototype.toString=function(){return this.rootExpression};var v=function(n,e){return t(e[0])&&(e[0]=n),e[0]?e[1]:e[2]},d={operators:[{name:"NOT",symbol:"!",rank:"80",optype:"1",func:function(n,e){return t(e[0])?n:!e[0]}},{name:"NG",symbol:"-",rank:"80",optype:"1",func:function(n,e){return t(e)?null:-e}},{name:"MUTI",symbol:"*",rank:"70",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?null:e[0]*e[1]}},{name:"DIV",symbol:"/",rank:"70",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?null:e[0]/e[1]}},{name:"MOD",symbol:"%",rank:"70",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?null:e[0]%e[1]}},{name:"PLUS",symbol:"+",rank:"60",optype:"2",func:function(n,e){return"string"==typeof e[0]&&"string"==typeof e[1]?e[0]+e[1]:t(e[0])||t(e[1])?null:e[0]+e[1]}},{name:"MINUS",symbol:"-",rank:"60",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?null:e[0]-e[1]}},{name:"LT",symbol:"<",rank:"50",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]<e[1]}},{name:"LE",symbol:"<=",rank:"50",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]<=e[1]}},{name:"GT",symbol:">",rank:"50",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]>e[1]}},{name:"GE",symbol:">=",rank:"50",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]>=e[1]}},{name:"EQ",symbol:"==",rank:"40",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]==e[1]}},{name:"NEQ",symbol:"!=",rank:"40",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]!=e[1]}},{name:"AND",symbol:"&&",rank:"30",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]&&e[1]},sfunc:function(n){return!n}},{name:"OR",symbol:"||",rank:"30",optype:"2",func:function(n,e){return t(e[0])||t(e[1])?n:e[0]||e[1]},sfunc:function(n){return n}},{name:"IFELSE-1",symbol:"?",rank:"10",optype:"3",func:v},{name:"IFELSE-2",symbol:":",rank:"10",optype:"3",func:v},{name:"IFELSE",symbol:"?:",rank:"10",optype:"3",func:v},{name:"testFunc",symbol:"testFunc",rank:"100",optype:"N",func:function(n,e,r){return e-r}},{name:"in",symbol:"in",rank:"100",optype:"N",func:function(n,e,r){if(void 0===r||null==r)return n;if(void 0===e||null==e||!Array.isArray(e))return n;var t;for(t=0;t<e.length;t+=1)if(e[t]==r)return!0;return!1}},{name:"length",symbol:"length",rank:"100",optype:"N",func:function(n,e){return void 0===e||null==e?0:e.length}},{name:"isNaN",symbol:"isNaN",rank:"100",optype:"N",func:function(n,e){return isNaN(e)}},{name:"number",symbol:"number",rank:"100",optype:"N",func:function(n,e){return Number(e)}},{name:"parseInt",symbol:"parseInt",rank:"100",optype:"N",func:function(n,e,r){return parseInt(e,r)}},{name:"parseFloat",symbol:"parseFloat",rank:"100",optype:"N",func:function(n,e){return parseFloat(e)}},{name:"split",symbol:"split",rank:"100",optype:"N",func:function(n,e,r,o){return t(e)?n:e.split(r)[o]}},{name:"min",symbol:"min",rank:"100",optype:"N",func:function(n,e,r){if(t(e)||t(r))return n;if("number"!=typeof e||"number"!=typeof r)throw new Error("JSParse Exception: Wrong type in Func:min !");return e<r?e:r}},{name:"max",symbol:"max",rank:"100",optype:"N",func:function(n,e,r){if(t(e)||t(r))return n;if("number"!=typeof e||"number"!=typeof r)throw new Error("JSParse Exception: Wrong type in Func:min !");return e<r?r:e}},{name:"getYear",symbol:"getYear",rank:"100",optype:"N",func:function(n){return(new Date).getFullYear()}},{name:"getMonth",symbol:"getMonth",rank:"100",optype:"N",func:function(n){return(new Date).getMonth()+1}},{name:"getDay",symbol:"getDay",rank:"100",optype:"N",func:function(n){return(new Date).getDate()}},{name:"getHours",symbol:"getHours",rank:"100",optype:"N",func:function(n){return(new Date).getHours()}},{name:"getMinutes",symbol:"getMinutes",rank:"100",optype:"N",func:function(n){return(new Date).getMinutes()}},{name:"getSeconds",symbol:"getSeconds",rank:"100",optype:"N",func:function(n){return(new Date).getSeconds()}}],leftBracket:"(",rightBracket:")",quote:'"',singleQuote:"'",space:" ",comma:",",questionMark:"?",colon:":"};return n.prototype.build=function(n){return t(n)?r(u("NOP"),n):N(k(n),null,n)},e.prototype.calc=function(n,e){var r=this;if((null==r.pChildNodes||r.pChildNodes.length<=0)&&"[object Function]"!==Object.prototype.toString.call(r.selfObj.func)){var o=p(e,r.selfObj);return void 0===o&&r.rootExpression==r.selfObj?n:o}var s=u(r.selfObj.name);if(null==s)throw new Error("JSParse Exception: Wrong operator!");var l=[];"N"==s.optype&&l.push(n);var i,f,a;for(i=0;i<r.pChildNodes.length;i+=1){if(f=r.pChildNodes[i],a=f.calc(n,e),!t(s.sfunc)&&s.sfunc(a))return a;l.push(a)}return"N"==s.optype?s.func.apply(this,l):s.func(n,l)},n});