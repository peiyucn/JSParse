/* created at Thursday, November 2nd, 2017, 2:48:09 PM by Pei Yu */!function(n,r){n.JSParse=r()}(this,function(){function n(){}function r(n,r){this.selfObj=n,this.rootExpression=r,this.pChildNodes=[]}function e(n,e){var t=new r(n,e);return t.selfObj=n,t.rootExpression=e,t}function t(n){return void 0===n||null==n||n.length<=0}function o(n){var r,e;for(r=0;r<E.operators.length;r+=1)if((e=E.operators[r]).symbol==n)return e;return null}function u(n){var r,e;for(r=0;r<E.operators.length;r+=1)if((e=E.operators[r]).name==n)return e;return null}function s(n,r){var e,t;for(e=0;e<E.operators.length;e+=1)if((t=E.operators[e]).symbol.substr(r,1)==n&&"N"!=t.optype)return!0;return!1}function l(n,r){var e,t;for(e=0;e<E.operators.length;e+=1)if((t=E.operators[e]).symbol.substr(r,1)==n&&"N"==t.optype)return!0;return!1}function f(n){var r,e;for(r=0;r<E.operators.length;r+=1)if((e=E.operators[r]).name==n&&"N"==e.optype)return e;return null}function i(n){return 1==n?0:1}function a(n,r,e){var t,o=[];for(t=0;t<e;t+=1)o.push(n[r]),r++;return o}function p(n,r){var e=r.substr(0,1);if(e==E.quote||e==E.singleQuote)return r.replace(/^"*|"*$/g,"").replace(/^'*|'*$/g,"");var t=parseFloat(r);return isNaN(t)?"true"==r||"false"!=r&&n[r]:t}function c(n){var r;for(r=0;r<n.length;r+=1)if(":"==n[r])return r;return-1}function y(n){for(var r,e=-1,t=0,o=0,u=0;u<n.length;){if((r=n.substr(u,1))==E.quote&&(t=i(t)),r==E.singleQuote&&(o=i(o)),r==E.leftBracket&&0==t&&0==o)return e=u;u++}return e}function b(n,r){var e,t=r,o=0,u=0,s=0,l=!0;s+=1;do{if(++t>=n.length)break;if((e=n.substr(t,1))==E.quote&&(o=i(o)),e==E.singleQuote&&(u=i(u)),e==E.leftBracket&&0==o&&0==u&&s++,e==E.rightBracket&&0==o&&0==u&&s--,0==s)l=!1;else{if(!(s>0))break;l=!0}}while(l);if(0!=s)throw new Error("JSParse Exception: Wrong bracket numbers!");return t}function m(n){for(var r,e,t=[],o=0,u=0,s=0,l=0,f=0;o<n.length;)(r=n.substr(o,1))==E.quote&&(l=i(l)),r==E.singleQuote&&(f=i(f)),r==E.leftBracket&&0==l&&0==f&&s++,r==E.rightBracket&&0==l&&0==f&&s--,r==E.comma&&0==l&&0==f&&0==s&&(e=(e=n.substr(u,o-u)).replace(/^\s+|\s+$/g,""),t.push(e),u=o+1),o==n.length-1&&(e=(e=n.substr(u,n.length-u)).replace(/^\s+|\s+$/g,""),t.push(e)),o++;return t}function h(n,r){return-1==r||n[r]==E.leftBracket||s(n[r],0)?u("NG"):n[r]!=E.space?u("MINUS"):void h(n,r-1)}function g(n,r,e){if(!(e>=n.length)){var t,o,u,f,a=0,p=n.substr(e,1);if(p==E.quote){if(a=i(a),t=n.indexOf(E.quote,e),o=-1,(o=n.indexOf(E.quote,t+1))<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");a=i(a),u=n.substring(t,o+1),r.push(u),e=o+1}else if(p==E.singleQuote){if(a=i(a),t=n.indexOf(E.singleQuote,e),o=-1,(o=n.indexOf(E.singleQuote,t+1))<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");a=i(a),u=n.substring(t,o+1),r.push(u),e=o+1}else if(p==E.leftBracket){var c=n.indexOf(E.leftBracket,e),y=b(n,c);e=y;var m=n.substring(c+1,y);r.push(m),e++}else if(s(p,0)){var h=e,k=!0,N=1,v=null;if(p==E.questionMark||p==E.colon)v=n.substring(h,e+1),r.push(v),e++;else{for(;k&&!(++e>=n.length);)s(f=n.substr(e,1),N)?(k=!0,N++):k=!1;v=n.substring(h,e),r.push(v)}}else if(p==E.space)e++;else{for(var d=e,x=!0,O=0;e<n.length;){if(f=n.substr(e,1),l(f,O))x=!0,O++;else if(s(f,0)){x=!1;break}if(f==E.leftBracket){x=!0;break}e++}var w=null;if(x&&f==E.leftBracket){var S=b(n,e);w=n.substring(d,S+1),e=S+1}else w=n.substring(d,e);w=w.replace(/^\s+|\s+$/g,""),r.push(w)}g(n,r,e)}}function k(n){var r=[];return g(n,r,0),null==r||0==r.length?null:r}function N(n,r,t){var u,s,l,i,p,b,g,v,E,d=[],x=null,O=0,w=0,S=0,j=[];if(1==n.length){if(1==(d=k(n[0])).length){var q=y(n[0]);if(!(q>0)){var B=e(n[0]);return null==r||null==r.selfObj?(r=B).rootExpression=t:r.addNode(B),r}var P=f(n[0].substr(0,q));if(null==P)throw new Error("JSParse Exception: Wrong function name!");d=m(n[0].substr(q+1,n[0].length-(q+2))),x=P}n=d}for(u=0;u<n.length;u+=1)if(null!=(v=o(n[u]))){if("-"==v.symbol&&(v=h(n,u-1)),"?"==v.symbol){if(-1==(S=c(n)))throw new Error("JSParse Exception: Wrong expression!");x=o("?:"),w=u;break}null==x?(x=v,O=u):v.rank<=x.rank&&(x=v,O=u)}if(null==x)throw new Error("JSParse Exception: Wrong expressions!");var F=e(x);if(null==r||null==r.selfObj?(r=F).rootExpression=t:r.addNode(F),1==F.selfObj.optype)i=a(n,O+1,n.length-(O+1)),j.push(i);else if(2==F.selfObj.optype)p=a(n,0,O),b=a(n,O+1,n.length-(O+1)),j.push(p),j.push(b);else if(3==F.selfObj.optype)p=a(n,0,w),g=a(n,w+1,S-(w+1)),b=a(n,S+1,n.length-(S+1)),j.push(p),j.push(g),j.push(b);else if("N"==F.selfObj.optype)for(s=0;s<n.length;s+=1)E=[n[s]],j.push(E);for(l=0;l<j.length;l+=1)N(j[l],F,t);return r}r.prototype.addNode=function(n){return null==this?e(n):n==this.selfObj?this:void this.pChildNodes.push(n)},r.prototype.toString=function(){return this.rootExpression};var v=function(n,r){return t(r[0])&&(r[0]=n),r[0]?r[1]:r[2]},E={operators:[{name:"NOT",symbol:"!",rank:"80",optype:"1",func:function(n,r){return t(r[0])?n:!r[0]}},{name:"NG",symbol:"-",rank:"80",optype:"1",func:function(n,r){return t(r)?null:-r}},{name:"MUTI",symbol:"*",rank:"70",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]*r[1]}},{name:"DIV",symbol:"/",rank:"70",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]/r[1]}},{name:"MOD",symbol:"%",rank:"70",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]%r[1]}},{name:"PLUS",symbol:"+",rank:"60",optype:"2",func:function(n,r){return"string"==typeof r[0]&&"string"==typeof r[1]?r[0]+r[1]:t(r[0])||t(r[1])?null:r[0]+r[1]}},{name:"MINUS",symbol:"-",rank:"60",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]-r[1]}},{name:"LT",symbol:"<",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]<r[1]}},{name:"LE",symbol:"<=",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]<=r[1]}},{name:"GT",symbol:">",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]>r[1]}},{name:"GE",symbol:">=",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]>=r[1]}},{name:"EQ",symbol:"==",rank:"40",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]==r[1]}},{name:"NEQ",symbol:"!=",rank:"40",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]!=r[1]}},{name:"AND",symbol:"&&",rank:"30",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]&&r[1]},sfunc:function(n){return!n}},{name:"OR",symbol:"||",rank:"30",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]||r[1]},sfunc:function(n){return!!n}},{name:"IFELSE-1",symbol:"?",rank:"10",optype:"3",func:v},{name:"IFELSE-2",symbol:":",rank:"10",optype:"3",func:v},{name:"IFELSE",symbol:"?:",rank:"10",optype:"3",func:v},{name:"testFunc",symbol:"testFunc",rank:"100",optype:"N",func:function(n,r,e){return r-e}},{name:"in",symbol:"in",rank:"100",optype:"N",func:function(n,r,e){if(void 0===e||null==e)return n;if(void 0===r||null==r||!Array.isArray(r))return n;var t;for(t=0;t<r.length;t+=1)if(r[t]==e)return!0;return!1}},{name:"length",symbol:"length",rank:"100",optype:"N",func:function(n,r){return void 0===r||null==r?0:r.length}},{name:"isNaN",symbol:"isNaN",rank:"100",optype:"N",func:function(n,r){return isNaN(r)}},{name:"Number",symbol:"Number",rank:"100",optype:"N",func:function(n,r){return Number(r)}},{name:"parseInt",symbol:"parseInt",rank:"100",optype:"N",func:function(n,r,e){return parseInt(r,e)}},{name:"parseFloat",symbol:"parseFloat",rank:"100",optype:"N",func:function(n,r){return parseFloat(r)}},{name:"splitExt",symbol:"splitExt",rank:"100",optype:"N",func:function(n,r,e,o){return t(r)?n:r.split(e)[o]}},{name:"min",symbol:"min",rank:"100",optype:"N",func:function(n,r,e){if(t(r)||t(e))return n;if("number"!=typeof r||"number"!=typeof e)throw new Error("JSParse Exception: Wrong type in Func:min !");return r<e?r:e}},{name:"max",symbol:"max",rank:"100",optype:"N",func:function(n,r,e){if(t(r)||t(e))return n;if("number"!=typeof r||"number"!=typeof e)throw new Error("JSParse Exception: Wrong type in Func:min !");return r<e?e:r}}],leftBracket:"(",rightBracket:")",quote:'"',singleQuote:"'",space:" ",comma:",",questionMark:"?",colon:":"};return n.prototype.build=function(n){return t(n)?e(u("NOP"),n):N(k(n),null,n)},r.prototype.calc=function(n,r){var e=this;if(null==e.pChildNodes||e.pChildNodes.length<=0){if("object"==typeof e.selfObj)return e.selfObj.func(n);var o=p(r,e.selfObj);return void 0===o&&e.rootExpression==e.selfObj?n:o}var s=u(e.selfObj.name);if(null==s)throw new Error("JSParse Exception: Wrong operator!");var l=[];"N"==s.optype&&l.push(n);var f,i,a;for(f=0;f<e.pChildNodes.length;f+=1){if(i=e.pChildNodes[f],a=i.calc(n,r),!t(s.sfunc)&&s.sfunc(a))return a;l.push(a)}return"N"==s.optype?s.func.apply(this,l):s.func(n,l)},n});