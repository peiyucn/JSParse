/* created at Monday, October 23rd, 2017, 1:12:44 PM by Pei Yu */!function(n,e){n.JSParse=e()}(this,function(){function n(){}function e(n,e){this.selfObj=n,this.rootExpression=e,this.pChildNodes=[]}function r(n,r){var t=new e(n,r);return t.selfObj=n,t.rootExpression=r,t}function t(n){return"undefined"==typeof n||null==n||n.length<=0}function o(n){var e,r;for(e=0;e<V.operators.length;e+=1)if(r=V.operators[e],r.symbol==n)return r;return null}function u(n){var e,r;for(e=0;e<V.operators.length;e+=1)if(r=V.operators[e],r.name==n)return r;return null}function s(n,e){var r,t;for(r=0;r<V.operators.length;r+=1)if(t=V.operators[r],t.symbol.substr(e,1)==n&&"N"!=t.optype)return!0;return!1}function f(n,e){var r,t;for(r=0;r<V.operators.length;r+=1)if(t=V.operators[r],t.symbol.substr(e,1)==n&&"N"==t.optype)return!0;return!1}function l(n){var e,r;for(e=0;e<V.operators.length;e+=1)if(r=V.operators[e],r.name==n&&"N"==r.optype)return r;return null}function i(n){return 1==n?0:1}function a(n,e,r){var t,o=[];for(t=0;t<r;t+=1)o.push(n[e]),e++;return o}function p(n,e){var r=e.substr(0,1);if(r==V.quote||r==V.singleQuote)return e.replace(/^"*|"*$/g,"").replace(/^'*|'*$/g,"");var t=parseFloat(e);return isNaN(t)?"true"==e||"false"!=e&&n[e]:t}function c(n){var e;for(e=0;e<n.length;e+=1)if(":"==n[e])return e;return-1}function y(n){for(var e,r=-1,t=0,o=0,u=0;u<n.length;){if(e=n.substr(u,1),e==V.quote&&(t=i(t)),e==V.singleQuote&&(o=i(o)),e==V.leftBracket&&0==t&&0==o)return r=u;u++}return r}function b(n,e){var r,t=e,o=0,u=0,s=0,f=!0;s+=1;do{if(t++,t>=n.length)break;if(r=n.substr(t,1),r==V.quote&&(o=i(o)),r==V.singleQuote&&(u=i(u)),r==V.leftBracket&&0==o&&0==u&&s++,r==V.rightBracket&&0==o&&0==u&&s--,0==s)f=!1;else{if(!(s>0))break;f=!0}}while(f);if(0!=s)throw new Error("JSParse Exception: Wrong bracket numbers!");return t}function m(n){for(var e,r,t=[],o=0,u=0,s=0,f=0,l=0;o<n.length;)e=n.substr(o,1),e==V.quote&&(f=i(f)),e==V.singleQuote&&(l=i(l)),e==V.leftBracket&&0==f&&0==l&&s++,e==V.rightBracket&&0==f&&0==l&&s--,e==V.comma&&0==f&&0==l&&0==s&&(r=n.substr(u,o-u),r=r.replace(/^\s+|\s+$/g,""),t.push(r),u=o+1),o==n.length-1&&(r=n.substr(u,n.length-u),r=r.replace(/^\s+|\s+$/g,""),t.push(r)),o++;return t}function h(n,e){return e==-1||n[e]==V.leftBracket||s(n[e],0)?u("NG"):n[e]!=V.space?u("MINUS"):void h(n,e-1)}function g(n,e,r){if(!(r>=n.length)){var t,o,u,l,a=0,p=n.substr(r,1);if(p==V.quote){if(a=i(a),t=n.indexOf(V.quote,r),o=-1,o=n.indexOf(V.quote,t+1),o<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");a=i(a),u=n.substring(t,o+1),e.push(u),r=o+1}else if(p==V.singleQuote){if(a=i(a),t=n.indexOf(V.singleQuote,r),o=-1,o=n.indexOf(V.singleQuote,t+1),o<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");a=i(a),u=n.substring(t,o+1),e.push(u),r=o+1}else if(p==V.leftBracket){var c=n.indexOf(V.leftBracket,r),y=b(n,c);r=y;var m=n.substring(c+1,y);e.push(m),r++}else if(s(p,0)){var h=r,k=!0,N=1,d=null;if(p==V.questionMark||p==V.colon)d=n.substring(h,r+1),e.push(d),r++;else{for(;k&&(r++,!(r>=n.length));)l=n.substr(r,1),s(l,N)?(k=!0,N++):k=!1;d=n.substring(h,r),e.push(d)}}else if(p==V.space)r++;else{for(var v=r,E=!0,x=0;r<n.length;){if(l=n.substr(r,1),f(l,x))E=!0,x++;else if(s(l,0)){E=!1;break}if(l==V.leftBracket){E=!0;break}r++}var O=null;if(E&&l==V.leftBracket){var w=b(n,r);O=n.substring(v,w+1),r=w+1}else O=n.substring(v,r);O=O.replace(/^\s+|\s+$/g,""),e.push(O)}g(n,e,r)}}function k(n){var e=0,r=[];return g(n,r,e),null==r||0==r.length?null:r}function N(n,e,t){var u,s,f,i,p,b,g,d,v,E=[],x=null,O=0,w=0,S=0,j=[];if(1==n.length){if(E=k(n[0]),1==E.length){var q=y(n[0]);if(!(q>0)){var B=r(n[0]);return null==e||null==e.selfObj?(e=B,e.rootExpression=t):e.addNode(B),e}var P=n[0].substr(0,q),F=l(P);if(null==F)throw new Error("JSParse Exception: Wrong function name!");var I=n[0].substr(q+1,n[0].length-(q+2));E=m(I),x=F}n=E}for(u=0;u<n.length;u+=1)if(d=o(n[u]),null!=d){if("-"==d.symbol&&(d=h(n,u-1)),"?"==d.symbol){if(S=c(n),S==-1)throw new Error("JSParse Exception: Wrong expression!");x=o("?:"),w=u;break}null==x?(x=d,O=u):d.rank<=x.rank&&(x=d,O=u)}if(null==x)throw new Error("JSParse Exception: Wrong expressions!");var J=r(x);if(null==e||null==e.selfObj?(e=J,e.rootExpression=t):e.addNode(J),1==J.selfObj.optype)i=a(n,O+1,n.length-(O+1)),j.push(i);else if(2==J.selfObj.optype)p=a(n,0,O),b=a(n,O+1,n.length-(O+1)),j.push(p),j.push(b);else if(3==J.selfObj.optype)p=a(n,0,w),g=a(n,w+1,S-(w+1)),b=a(n,S+1,n.length-(S+1)),j.push(p),j.push(g),j.push(b);else if("N"==J.selfObj.optype)for(s=0;s<n.length;s+=1)v=[n[s]],j.push(v);for(f=0;f<j.length;f+=1)N(j[f],J,t);return e}e.prototype.addNode=function(n){return null==this?r(n):n==this.selfObj?this:void this.pChildNodes.push(n)},e.prototype.toString=function(){return this.rootExpression};var d=function(n,e){return t(e[0])?n:!e[0]},v=function(n,e){return t(e)?null:-e},E=function(n,e){return t(e[0])||t(e[1])?null:e[0]*e[1]},x=function(n,e){return t(e[0])||t(e[1])?null:e[0]/e[1]},O=function(n,e){return t(e[0])||t(e[1])?null:e[0]%e[1]},w=function(n,e){return"string"==typeof e[0]&&"string"==typeof e[1]?e[0]+e[1]:t(e[0])||t(e[1])?null:e[0]+e[1]},S=function(n,e){return t(e[0])||t(e[1])?null:e[0]-e[1]},j=function(n,e){return t(e[0])||t(e[1])?n:e[0]<e[1]},q=function(n,e){return t(e[0])||t(e[1])?n:e[0]<=e[1]},B=function(n,e){return t(e[0])||t(e[1])?n:e[0]>e[1]},P=function(n,e){return t(e[0])||t(e[1])?n:e[0]>=e[1]},F=function(n,e){return t(e[0])||t(e[1])?n:e[0]==e[1]},I=function(n,e){return t(e[0])||t(e[1])?n:e[0]!=e[1]},J=function(n,e){return t(e[0])||t(e[1])?n:e[0]&&e[1]},Q=function(n,e){return t(e[0])||t(e[1])?n:e[0]||e[1]},W=function(n,e){return t(e[0])&&(e[0]=n),e[0]?e[1]:e[2]},C=function(n,e,r){return e-r},L=function(n,e,r){if("undefined"==typeof r||null==r)return n;if("undefined"==typeof e||null==e||!Array.isArray(e))return n;var t;for(t=0;t<e.length;t+=1)if(e[t]==r)return!0;return!1},M=function(n,e){return"undefined"==typeof e||null==e?0:e.length},$=function(n,e){return isNaN(e)},G=function(n,e){return Number(e)},T=function(n,e,r){return parseInt(e,r)},U=function(n,e){return parseFloat(e)},A=function(n,e,r,o){if(t(e))return n;var u=e.split(r);return u[o]},D=function(n,e,r){if("number"!=typeof e||"number"!=typeof r)throw new Error("JSParse Exception: Wrong type in Func:min !");return e<r?e:r},R=function(n,e,r){if("number"!=typeof e||"number"!=typeof r)throw new Error("JSParse Exception: Wrong type in Func:min !");return e<r?r:e},V={operators:[{name:"NOT",symbol:"!",rank:"80",optype:"1",func:d},{name:"NG",symbol:"-",rank:"80",optype:"1",func:v},{name:"MUTI",symbol:"*",rank:"70",optype:"2",func:E},{name:"DIV",symbol:"/",rank:"70",optype:"2",func:x},{name:"MOD",symbol:"%",rank:"70",optype:"2",func:O},{name:"PLUS",symbol:"+",rank:"60",optype:"2",func:w},{name:"MINUS",symbol:"-",rank:"60",optype:"2",func:S},{name:"LT",symbol:"<",rank:"50",optype:"2",func:j},{name:"LE",symbol:"<=",rank:"50",optype:"2",func:q},{name:"GT",symbol:">",rank:"50",optype:"2",func:B},{name:"GE",symbol:">=",rank:"50",optype:"2",func:P},{name:"EQ",symbol:"==",rank:"40",optype:"2",func:F},{name:"NEQ",symbol:"!=",rank:"40",optype:"2",func:I},{name:"AND",symbol:"&&",rank:"30",optype:"2",func:J,sfunc:function(n){return!n}},{name:"OR",symbol:"||",rank:"30",optype:"2",func:Q,sfunc:function(n){return!!n}},{name:"IFELSE-1",symbol:"?",rank:"10",optype:"3",func:W},{name:"IFELSE-2",symbol:":",rank:"10",optype:"3",func:W},{name:"IFELSE",symbol:"?:",rank:"10",optype:"3",func:W},{name:"testFunc",symbol:"testFunc",rank:"100",optype:"N",func:C},{name:"in",symbol:"in",rank:"100",optype:"N",func:L},{name:"length",symbol:"length",rank:"100",optype:"N",func:M},{name:"isNaN",symbol:"isNaN",rank:"100",optype:"N",func:$},{name:"Number",symbol:"Number",rank:"100",optype:"N",func:G},{name:"parseInt",symbol:"parseInt",rank:"100",optype:"N",func:T},{name:"parseFloat",symbol:"parseFloat",rank:"100",optype:"N",func:U},{name:"splitExt",symbol:"splitExt",rank:"100",optype:"N",func:A},{name:"min",symbol:"min",rank:"100",optype:"N",func:D},{name:"max",symbol:"max",rank:"100",optype:"N",func:R}],leftBracket:"(",rightBracket:")",quote:'"',singleQuote:"'",space:" ",comma:",",questionMark:"?",colon:":"};return n.prototype.build=function(n){if(t(n))return r(u("NOP"),n);var e=k(n);return N(e,null,n)},e.prototype.calc=function(n,e){var r=this;if(null==r.pChildNodes||r.pChildNodes.length<=0){if("object"==typeof r.selfObj)return r.selfObj.func(n);var o=p(e,r.selfObj);return"undefined"==typeof o&&r.rootExpression==r.selfObj?n:o}var s=u(r.selfObj.name);if(null==s)throw new Error("JSParse Exception: Wrong operator!");var f=[];"N"==s.optype&&f.push(n);var l,i,a;for(l=0;l<r.pChildNodes.length;l+=1){if(i=r.pChildNodes[l],a=i.calc(n,e),!t(s.sfunc)&&s.sfunc(a))return a;f.push(a)}var c=null;return c="N"==s.optype?s.func.apply(this,f):s.func(n,f)},n});