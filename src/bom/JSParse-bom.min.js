/* created at Saturday, October 28th, 2017, 4:43:27 PM by Pei Yu */!function(n,r){n.JSParse=r()}(this,function(){function n(){}function r(n,r){this.selfObj=n,this.rootExpression=r,this.pChildNodes=[]}function e(n,e){var t=new r(n,e);return t.selfObj=n,t.rootExpression=e,t}function t(n){return void 0===n||null==n||n.length<=0}function o(n){var r,e;for(r=0;r<d.operators.length;r+=1)if((e=d.operators[r]).symbol==n)return e;return null}function u(n){var r,e;for(r=0;r<d.operators.length;r+=1)if((e=d.operators[r]).name==n)return e;return null}function s(n,r){var e,t;for(e=0;e<d.operators.length;e+=1)if((t=d.operators[e]).symbol.substr(r,1)==n&&"N"!=t.optype)return!0;return!1}function l(n,r){var e,t;for(e=0;e<d.operators.length;e+=1)if((t=d.operators[e]).symbol.substr(r,1)==n&&"N"==t.optype)return!0;return!1}function f(n){var r,e;for(r=0;r<d.operators.length;r+=1)if((e=d.operators[r]).name==n&&"N"==e.optype)return e;return null}function a(n){return 1==n?0:1}function p(n,r,e){var t,o=[];for(t=0;t<e;t+=1)o.push(n[r]),r++;return o}function c(n,r){var e=r.substr(0,1);if(e==d.quote||e==d.singleQuote)return r.replace(/^"*|"*$/g,"").replace(/^'*|'*$/g,"");var t=parseFloat(r);if(!isNaN(t))return t;if("true"==r)return!0;if("false"==r)return!1;var o=r.split("."),u=n;for(i=0;i<o.length;i+=1)u=u[o[i]];return u}function m(n){var r;for(r=0;r<n.length;r+=1)if(":"==n[r])return r;return-1}function y(n){for(var r,e=-1,t=0,o=0,u=0;u<n.length;){if((r=n.substr(u,1))==d.quote&&(t=a(t)),r==d.singleQuote&&(o=a(o)),r==d.leftBracket&&0==t&&0==o)return e=u;u++}return e}function b(n,r){var e,t=r,o=0,u=0,s=0,i=!0;s+=1;do{if(++t>=n.length)break;if((e=n.substr(t,1))==d.quote&&(o=a(o)),e==d.singleQuote&&(u=a(u)),e==d.leftBracket&&0==o&&0==u&&s++,e==d.rightBracket&&0==o&&0==u&&s--,0==s)i=!1;else{if(!(s>0))break;i=!0}}while(i);if(0!=s)throw new Error("JSParse Exception: Wrong bracket numbers!");return t}function h(n){for(var r,e,t=[],o=0,u=0,s=0,i=0,l=0;o<n.length;)(r=n.substr(o,1))==d.quote&&(i=a(i)),r==d.singleQuote&&(l=a(l)),r==d.leftBracket&&0==i&&0==l&&s++,r==d.rightBracket&&0==i&&0==l&&s--,r==d.comma&&0==i&&0==l&&0==s&&(e=(e=n.substr(u,o-u)).replace(/^\s+|\s+$/g,""),t.push(e),u=o+1),o==n.length-1&&(e=(e=n.substr(u,n.length-u)).replace(/^\s+|\s+$/g,""),t.push(e)),o++;return t}function g(n,r){return-1==r||n[r]==d.leftBracket||s(n[r],0)?u("NG"):n[r]!=d.space?u("MINUS"):void g(n,r-1)}function k(n,r,e){if(!(e>=n.length)){var t,o,u,i,f=0,p=n.substr(e,1);if(p==d.quote){if(f=a(f),t=n.indexOf(d.quote,e),o=-1,(o=n.indexOf(d.quote,t+1))<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");f=a(f),u=n.substring(t,o+1),r.push(u),e=o+1}else if(p==d.singleQuote){if(f=a(f),t=n.indexOf(d.singleQuote,e),o=-1,(o=n.indexOf(d.singleQuote,t+1))<=-1)throw new Error("JSParse Exception: Wrong quote numbers!");f=a(f),u=n.substring(t,o+1),r.push(u),e=o+1}else if(p==d.leftBracket){var c=n.indexOf(d.leftBracket,e),m=b(n,c);e=m;var y=n.substring(c+1,m);r.push(y),e++}else if(s(p,0)){var h=e,g=!0,N=1,v=null;if(p==d.questionMark||p==d.colon)v=n.substring(h,e+1),r.push(v),e++;else{for(;g&&!(++e>=n.length);)s(i=n.substr(e,1),N)?(g=!0,N++):g=!1;v=n.substring(h,e),r.push(v)}}else if(p==d.space)e++;else{for(var E=e,x=!0,O=0;e<n.length;){if(i=n.substr(e,1),l(i,O))x=!0,O++;else if(s(i,0)){x=!1;break}if(i==d.leftBracket){x=!0;break}e++}var w=null;if(x&&i==d.leftBracket){var S=b(n,e);w=n.substring(E,S+1),e=S+1}else w=n.substring(E,e);w=w.replace(/^\s+|\s+$/g,""),r.push(w)}k(n,r,e)}}function N(n){var r=[];return k(n,r,0),null==r||0==r.length?null:r}function v(n,r,t){var u,s,i,l,a,c,b,k,E,d=[],x=null,O=0,w=0,S=0,j=[];if(1==n.length){if(1==(d=N(n[0])).length){var q=y(n[0]);if(!(q>0)){var B=e(n[0]);return null==r||null==r.selfObj?(r=B).rootExpression=t:r.addNode(B),r}var P=f(n[0].substr(0,q));if(null==P)throw new Error("JSParse Exception: Wrong function name!");d=h(n[0].substr(q+1,n[0].length-(q+2))),x=P}n=d}for(u=0;u<n.length;u+=1)if(null!=(k=o(n[u]))){if("-"==k.symbol&&(k=g(n,u-1)),"?"==k.symbol){if(-1==(S=m(n)))throw new Error("JSParse Exception: Wrong expression!");x=o("?:"),w=u;break}null==x?(x=k,O=u):k.rank<=x.rank&&(x=k,O=u)}if(null==x)throw new Error("JSParse Exception: Wrong expressions!");var F=e(x);if(null==r||null==r.selfObj?(r=F).rootExpression=t:r.addNode(F),1==F.selfObj.optype)l=p(n,O+1,n.length-(O+1)),j.push(l);else if(2==F.selfObj.optype)a=p(n,0,O),c=p(n,O+1,n.length-(O+1)),j.push(a),j.push(c);else if(3==F.selfObj.optype)a=p(n,0,w),b=p(n,w+1,S-(w+1)),c=p(n,S+1,n.length-(S+1)),j.push(a),j.push(b),j.push(c);else if("N"==F.selfObj.optype)for(s=0;s<n.length;s+=1)E=[n[s]],j.push(E);for(i=0;i<j.length;i+=1)v(j[i],F,t);return r}r.prototype.addNode=function(n){return null==this?e(n):n==this.selfObj?this:void this.pChildNodes.push(n)},r.prototype.toString=function(){return this.rootExpression};var E=function(n,r){return t(r[0])&&(r[0]=n),r[0]?r[1]:r[2]},d={operators:[{name:"NOT",symbol:"!",rank:"80",optype:"1",func:function(n,r){return t(r[0])?n:!r[0]}},{name:"NG",symbol:"-",rank:"80",optype:"1",func:function(n,r){return t(r)?null:-r}},{name:"MUTI",symbol:"*",rank:"70",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]*r[1]}},{name:"DIV",symbol:"/",rank:"70",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]/r[1]}},{name:"MOD",symbol:"%",rank:"70",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]%r[1]}},{name:"PLUS",symbol:"+",rank:"60",optype:"2",func:function(n,r){return"string"==typeof r[0]&&"string"==typeof r[1]?r[0]+r[1]:t(r[0])||t(r[1])?null:r[0]+r[1]}},{name:"MINUS",symbol:"-",rank:"60",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?null:r[0]-r[1]}},{name:"LT",symbol:"<",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]<r[1]}},{name:"LE",symbol:"<=",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]<=r[1]}},{name:"GT",symbol:">",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]>r[1]}},{name:"GE",symbol:">=",rank:"50",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]>=r[1]}},{name:"EQ",symbol:"==",rank:"40",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]==r[1]}},{name:"NEQ",symbol:"!=",rank:"40",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]!=r[1]}},{name:"AND",symbol:"&&",rank:"30",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]&&r[1]},sfunc:function(n){return!n}},{name:"OR",symbol:"||",rank:"30",optype:"2",func:function(n,r){return t(r[0])||t(r[1])?n:r[0]||r[1]},sfunc:function(n){return!!n}},{name:"IFELSE-1",symbol:"?",rank:"10",optype:"3",func:E},{name:"IFELSE-2",symbol:":",rank:"10",optype:"3",func:E},{name:"IFELSE",symbol:"?:",rank:"10",optype:"3",func:E},{name:"testFunc",symbol:"testFunc",rank:"100",optype:"N",func:function(n,r,e){return r-e}},{name:"in",symbol:"in",rank:"100",optype:"N",func:function(n,r,e){if(void 0===e||null==e)return n;if(void 0===r||null==r||!Array.isArray(r))return n;var t;for(t=0;t<r.length;t+=1)if(r[t]==e)return!0;return!1}},{name:"length",symbol:"length",rank:"100",optype:"N",func:function(n,r){return void 0===r||null==r?0:r.length}},{name:"isNaN",symbol:"isNaN",rank:"100",optype:"N",func:function(n,r){return isNaN(r)}},{name:"Number",symbol:"Number",rank:"100",optype:"N",func:function(n,r){return Number(r)}},{name:"parseInt",symbol:"parseInt",rank:"100",optype:"N",func:function(n,r,e){return parseInt(r,e)}},{name:"parseFloat",symbol:"parseFloat",rank:"100",optype:"N",func:function(n,r){return parseFloat(r)}},{name:"splitExt",symbol:"splitExt",rank:"100",optype:"N",func:function(n,r,e,o){return t(r)?n:r.split(e)[o]}},{name:"min",symbol:"min",rank:"100",optype:"N",func:function(n,r,e){if("number"!=typeof r||"number"!=typeof e)throw new Error("JSParse Exception: Wrong type in Func:min !");return r<e?r:e}},{name:"max",symbol:"max",rank:"100",optype:"N",func:function(n,r,e){if("number"!=typeof r||"number"!=typeof e)throw new Error("JSParse Exception: Wrong type in Func:min !");return r<e?e:r}}],leftBracket:"(",rightBracket:")",quote:'"',singleQuote:"'",space:" ",comma:",",questionMark:"?",colon:":"};return n.prototype.build=function(n){return t(n)?e(u("NOP"),n):v(N(n),null,n)},r.prototype.calc=function(n,r){var e=this;if(null==e.pChildNodes||e.pChildNodes.length<=0){var o=c(r,e.selfObj);return void 0===o&&e.rootExpression==e.selfObj?n:o}var s=u(e.selfObj.name);if(null==s)throw new Error("JSParse Exception: Wrong operator!");var i=[];"N"==s.optype&&i.push(n);var l,f,a;for(l=0;l<e.pChildNodes.length;l+=1){if(f=e.pChildNodes[l],a=f.calc(n,r),!t(s.sfunc)&&s.sfunc(a))return a;i.push(a)}return"N"==s.optype?s.func.apply(this,i):s.func(n,i)},n});